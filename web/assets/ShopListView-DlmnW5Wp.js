import{d as j,r,b as A,e as D,c as O,a as i,f as t,w as a,g as l,h as d,i as B,t as U,E as h,o as H,_ as I}from"./index-B8qFLkXp.js";import{g as w}from"./apiConfig-B6_P2rPa.js";const J={class:"shop-list"},K={class:"toolbar"},L={class:"toolbar-right"},M={class:"dialog-footer"},$={class:"table-container"},q=j({__name:"ShopListView",setup(F){const _=r([]),m=r(1),f=r(10),p=r(!1),s=r(""),v=r(!1),C=A(()=>{const o=(m.value-1)*f.value,e=o+f.value;return _.value.slice(o,e)}),V=o=>{m.value=o},g=async()=>{try{const o=await fetch(w("/api/shops_list"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();_.value=Array.isArray(e)?e:e?.data??[]}catch(o){console.error("加载店铺列表失败",o)}},S=()=>{s.value="",p.value=!0},y=()=>{p.value=!1,s.value=""},b=async()=>{if(!s.value.trim()){h.warning("请输入店铺代码");return}v.value=!0;try{const o=await fetch(w("/api/add_shop"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop_code:s.value.trim()})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();h.success("新增店铺成功"),p.value=!1,s.value="",g()}catch(o){console.error("新增店铺失败",o),h.error("新增店铺失败，请重试")}finally{v.value=!1}};return D(()=>{g()}),(o,e)=>{const u=l("el-button"),k=l("el-input"),x=l("el-form-item"),T=l("el-form"),z=l("el-dialog"),c=l("el-table-column"),P=l("el-link"),E=l("el-table"),N=l("el-pagination");return H(),O("div",J,[i("div",K,[e[3]||(e[3]=i("div",{class:"toolbar-left"},[i("h2",null,"店铺列表")],-1)),i("div",L,[t(u,{type:"primary",onClick:S},{default:a(()=>[...e[2]||(e[2]=[d("新增店铺",-1)])]),_:1})])]),t(z,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n),title:"新增店铺",width:"500px","before-close":y},{footer:a(()=>[i("span",M,[t(u,{onClick:y},{default:a(()=>[...e[4]||(e[4]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",loading:v.value,onClick:b},{default:a(()=>[...e[5]||(e[5]=[d(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(T,{model:{shopCode:s.value},"label-width":"80px"},{default:a(()=>[t(x,{label:"店铺代码"},{default:a(()=>[t(k,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n),placeholder:"请输入店铺代码",clearable:"",onKeyup:B(b,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),i("div",$,[t(E,{data:C.value,stripe:"",resizable:""},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"120"}),t(c,{prop:"shop_code",label:"店铺代码",width:"200"}),t(c,{label:"店铺链接","min-width":"300","show-overflow-tooltip":""},{default:a(n=>[t(P,{type:"primary",href:n.row.shop_index_url,target:"_blank"},{default:a(()=>[d(U(n.row.shop_index_url),1)]),_:2},1032,["href"])]),_:1}),t(c,{label:"操作",width:"180"},{default:a(n=>[t(u,{type:"primary",size:"small"},{default:a(()=>[...e[6]||(e[6]=[d("编辑",-1)])]),_:1}),t(u,{type:"danger",size:"small"},{default:a(()=>[...e[7]||(e[7]=[d("删除",-1)])]),_:1})]),_:1})]),_:1},8,["data"]),t(N,{onCurrentChange:V,"current-page":m.value,"page-size":f.value,layout:"prev, pager, next",total:_.value.length},null,8,["current-page","page-size","total"])])])}}}),R=I(q,[["__scopeId","data-v-d6a23002"]]);export{R as default};
